{% extends "layout.html" %}
{% block head %}

<link rel='stylesheet' type='text/css' href='http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.18/themes/smoothness/jquery-ui.css'/>
<script type='text/javascript' src='https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.18/jquery-ui.min.js'></script>
<link href="{{ url_for('static', filename='jquery-weekcalendar/jquery.weekcalendar.css') }}" rel="stylesheet">
<script type='text/javascript'
        src="{{ url_for('static', filename='jquery-weekcalendar/jquery.weekcalendar.js') }}"></script>

<script>
  var URL_FOR = {
    'getUserID': "{{ url_for('getUserID') }}",
    'trips': "{{ url_for('showTrip') }}",
    'getTrips': "{{ url_for('getTrips') }}"
  };
</script>

<script src="{{ url_for('static', filename='trip.js') }}"></script>
<script src="{{ url_for('static', filename='TripModel.js') }}"></script>
<script src="{{ url_for('static', filename='TripView.js') }}"></script>
<script src="{{ url_for('static', filename='TripController.js') }}"></script>
<script src="{{ url_for('static', filename='Collaborators.js') }}"></script>
<script src="{{ url_for('static', filename='EventTypes.js') }}"></script>
<script src="{{ url_for('static', filename='event.js') }}"></script>
<script src="{{ url_for('static', filename='map.js') }}"></script>
<script src="{{ url_for('static', filename='permission.js') }}"></script>
<script src="{{ url_for('static', filename='pageView.js') }}"></script>
<script src="{{ url_for('static', filename='resize.js') }}"></script>
<script src="{{ url_for('static', filename='myTrips.js') }}"></script>
<script src="{{ url_for('static', filename='util.js') }}"></script>
<script src="{{ url_for('static', filename='log.js') }}"></script>


<script src="{{ url_for('static', filename='bootstrap/js/bootstrap-modal.js') }}"></script>
<script src="{{ url_for('static', filename='bootstrap/js/bootstrap-tooltip.js') }}"></script>
<script src="{{ url_for('static', filename='bootstrap/js/bootstrap-popover.js') }}"></script>
<script src="{{ url_for('static', filename='bootstrap/js/bootstrap-button.js') }}"></script>

<link href="{{ url_for('static', filename='bootstrap-datepicker/css/datepicker.css') }}" rel="stylesheet">
<script src="{{ url_for('static', filename='bootstrap-datepicker/js/bootstrap-datepicker.js') }}"></script>
<link href="{{ url_for('static', filename='jQueryTimepicker/timePicker.css') }}" rel="stylesheet">
<script src="{{ url_for('static', filename='jQueryTimepicker/jquery.timePicker.min.js') }}"></script>


<link href="{{ url_for('static', filename='trip.css') }}" rel="stylesheet">
<link href="{{ url_for('static', filename='map.css') }}" rel="stylesheet">
<link href="{{ url_for('static', filename='events.css') }}" rel="stylesheet">
<link href="{{ url_for('static', filename='log.css') }}" rel="stylesheet">

<script type="text/javascript"
        src="http://maps.googleapis.com/maps/api/js?key=AIzaSyDapSy04O3iMqxkwYsHqp-nUZaHY_0LLx0&sensor=false&libraries=places">
</script>

<!-- 
<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?sensor=true&libraries=places"></script>
 -->
<link href="{{ url_for('static', filename='events.css') }}" rel="stylesheet">

{% endblock %}

{% block nav %}
<li>
  <button class="btn btn-inverse" id="home-btn">
    <i class='icon-home icon-white'></i>
    Home
  </button>
</li>
<li>
  <button class="btn btn-inverse" id="refresh-btn">
    <i class='icon-refresh icon-white'></i>
    Refresh
  </button>
</li>
{% endblock %}

{% block nav_right %}
<li>
  <div ng-controller="CollaboratorsCtrl">
    <button class="btn btn-inverse" id="collaborators-btn" ng-click="open()">
      <i class='icon-user icon-white'></i>
      Collaborators
    </button>
    <script type="text/ng-template" id="collaboratorsModal.html">
      <div modal="isOpenFlag">
        <div class="modal-header">
          <a class="close" ng-click="close()">×</a>
          <h3>Collaborators</h3>
        </div>
        <div class="modal-body">
          <div class="row">
            <div class="span2"><h4>Username</h4></div>
            <div class="span2"><h4>Permission</h4></div>
          </div>
          <hr>
          <div id="collaborators" ng-repeat="c in tempDataCollaborators" name="collaborators">
            <div class="row">
              <div class="span2">[[c.username]]</div>
              <div class="span2 select">
                <select class="input-small collaborator permission" ng-model="c.permission" ng-change="setDirty()" ng-disabled="c.permission==4" id="c.id">
                  <option value="1" ng-selected="c.permission===1" ng-show="c.permission===4">Can view</option>
                  <option value="2" ng-selected="c.permission===2" ng-show="c.permission===4">Can edit</option>
                  <option value="3" ng-selected="c.permission===3" ng-show="c.permission===4">Can share</option>
                  <option value="4" ng-selected="c.permission===4" disabled="disabled" ng-show="c.permission==4">Is owner</option>
                </select>
              </div>
              <div class="span1 removeCollaborator" id="c.id" ng-show="c.permission!=4">
                <a class="close" ng-click="remove(c.id)">&times;</a>
              </div>
            </div>
          </div>
          <div ng-show="dataPermission>=3" id="invite-container">
            <div class="well" id="invite-input" ng-show="!isDirtyFlag">
              <div>Add an collaborator</div>
              <input class="input span2" id="inviteName" ng-model="collaborators.inviteName" placeholder="Type in an username...">
              <select class="input-small" id="invite-permission" ng-model="collaborators.invitePermission" ng-show="collaborators.inviteName">
                <option value="1">Can view</option>
                <option value="2">Can edit</option>
                <option value="3">Can share</option>
              </select>

              <p id="invite-control" ng-show="collaborators.inviteName">
                <a href="#" class="btn btn-success" id="invite-confirm-btn" ng-click="invite(collaborators.inviteName, collaborators.invitePermission)">Share</a>
                <a href="#" class="btn" id="invite-cancel-btn" ng-click="clearInvite()">Cancel</a>
              </p>
            </div>
            <div class="well" id="invite-alt" ng-show="isDirtyFlag">
              You have made changes that you need to save.
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <a href="#" class="btn btn-primary" id="collaborators-done-btn" ng-show="!isDirtyFlag && !collaborators.inviteName" ng-click="close()">Done</a>
          <a href="#" class="btn btn-success" id="collaborators-confirm-btn" ng-show="isDirtyFlag" ng-click="commitChanges()">Save Changes</a>
          <a href="#" class="btn" id="collaborators-cancel-btn" ng-show="isDirtyFlag" ng-click="close()">Cancel</a>
        </div>

      </div>
    </script>
  </div>

</li>
<li class="dropdown" id="myTrips">
  <a class="dropdown-toggle" data-toggle="dropdown" href="#menu1">
    My trips
    <b class="caret"></b>
  </a>
  <ul class="dropdown-menu" id="myTrips-list" ng-controller="MyTripsCtrl">
    <li ng-repeat="trip in dataTrips"><a ng-href="[[ TripsURL + trip.id ]]">[[trip.name]]</a></li>
    <li class="divider"></li>
    <li style="cursor: pointer"><a ng-click="openCreateTripModal()">+ Create a new trip...</a></li>

    <script type="text/ng-template" id="createTripModal.html">
      <div>
        <div class="modal-header">
          <button class="close" ng-click="closeCreateTripModal()">×</button>
          <h3>Create a trip</h3>
        </div>
        <form method="post" action="{{ url_for('newTrip') }}">
          <div class="modal-body">
            <input class="input" name="name" id="newtripname">
          </div>
          <div class="modal-footer">
            <a href="#" class="btn" ng-click="closeCreateTripModal()">Close</a>
            <button class="btn btn-success" type="submit">Create trip</button>
          </div>
        </form>
      </div>
    </script>
  </ul>
</li>
{% endblock %}

{% block before %}

<div class="gray height-fixed" id="page-control">
  <div class="subContainer width-fixed">
    <div class="btn-group" data-toggle="buttons-radio">
      <button id="map-view-btn" class="btn btn-info active"><a class="icon-white icon-map-marker"></a>&nbsp;Map View
      </button>
      <button id="cal-view-btn" class="btn btn-info"><a class="icon-white icon-calendar"></a>&nbsp;Calendar View
      </button>
    </div>
  </div>
  <div class="subContainer width-floating">
    <div id="logContainer" class="pull-right" ng-controller="LogCtrl">
      <div class="alert alert-error" id="log-content" ng-show="dataLogs">
        <strong>[[dataLogs[0].username]]</strong>
        <span ng-show="dataLogs[0].type==1">added <strong>[[dataLogs[0].event]]</strong> to the schedule.</span>
        <span ng-show="dataLogs[0].type==2">updated <strong>[[dataLogs[0].event]]</strong></span>
        <span ng-show="dataLogs[0].type==3">rescheduled the itinerary</span>
        <span ng-show="dataLogs[0].type==4">deleted <strong>[[dataLogs[0].event]]</strong> from the schedule.</span>
      </div>
    </div>
  </div>
</div>

{% endblock %}

{% block body %}
{# Events #}
<div class="height-floating width-floating subContainer" id="event-calendar">
  <div id="calendar"></div>
</div>
<div class="width-fixed subContainer" id="eventsContainer">
  <h3 class="height-fixed">Scheduled Itinerary</h3>

  <div class="height-fixed">&nbsp;</div>
  <div class="gray height-floating" id="event-list">
    <div id="events" class="height-floating">
      <ul id="events-list" class="nav nav-pills nav-stacked" ui-sortable="sortableOptions" ng-model="dataEvents">
        <li id="$index" ng-repeat="e in tempDataEvents">
          <a style="cursor: move;">
            <table class="event-table">
              <tbody>
                <tr>
                  <td class="event-marker"></td>
                  <td class="event-name" rel="popover">
                    <a class="warning warning-conflict badge badge-important" ng-show="hasConflict($index)">!</a>
                    [[ e.name ]]
                  </td>
                  <td class="event-icons">
                    <i class="icon-pencil clickable hide-plevel-2 updateEvent" ng-click="showUpdateEvent(e)"></i>
                    <a class="close hide-plevel-2 removeEvent" ng-click="removeEvent(e.id)">&times;</a>
                  </td>
                </tr>
              </tbody>
            </table>
          </a>
          <div class="travelTime" ng-show="isTravelTimeShownFlag && $index < tempDataEvents.length-1">
            <table>
              <tbody>
                <tr>
                  <td class="travelTime-arrow"><a class="icon-arrow-down"></a></td>
                  <td class="travelTime-time">sdf</td>
                </tr>
              </tbody>
            </table>
          </div>
        </li>
      </ul>
    </div>
    <div id="events-optimized" class="height-floating">
      <ul id="events-list-optimized" class="nav nav-pills nav-stacked">
      </ul>
    </div>
    <div class="height-fixed" id="optimize-control">
      <button class="btn btn-primary" id="optimize-optimize-btn">Optimize the order</button>
      <span class="optimize-after">Do you want to save this change?</span>
      <button class="btn btn-success optimize-after" id="optimize-save-btn">Yes</button>
      <button class="btn optimize-after" id="optimize-cancel-btn">No</button>
    </div>
  </div>
  <style>
    .modal-body{overflow-y: visible;}
  </style>
  <script type="text/ng-template" id="editEventModal.html">
    <div modal="isEditEventOpenFlag" id="editEvent-modal">
      <div class="modal-header">
        <a class="close" ng-click="hideEditEvent()">×</a>

        <h3 id="editEvent-title">[[ title ]]</h3>
      </div>
      <div class="modal-body" style="overflow-y: visible;">
        <form class="form-horizontal">
          <input class="input-small" type=hidden id="editEvent-id" ng-model="editEventData.id">

          <div class="control-group">
            <label class="control-label">name</label>

            <div class="controls">
              <input class="input-large" type=text id="editEvent-name" ng-model="editEventData.name">
            </div>
          </div>
          <div class="control-group">
            <label class="control-label">type</label>

            <div class="controls">
              <select id="editEvent-type" ng-model="editEventData.type_id">
                <option value="[[type.id]]" ng-selected="editEventData.type_id==type.id" ng-repeat="type in dataEventTypes">[[type.name]]</option>
                <option disabled="disabled">--------------</option>
                <option value="">Other...</option>
              </select>
              <br id="addEventType-spacer" ng-show="!editEventData.type_id">&nbsp;</br>
              <input id="addEventType-name" placeholder="Input type here..." ng-model="editEventData.type_name" ng-show="!editEventData.type_id">
            </div>
          </div>

          <div class="control-group" id="editEvent-startTimeGroup">
            <label class="control-label">start time</label>

            <div class="controls">
              <input class="input-small" type="text" datepicker-popup="MM/dd/yyyy" ng-model="editEventData.start_time" ng-required="true" readonly>
              <input class="input-mini time" type=text value="[[ editEventData.start_time | date:'HH:mm' ]]" id="editEvent-startTime" readonly>
            </div>
          </div>

          <div class="control-group" id="editEvent-endTimeGroup">
            <label class="control-label">end time</label>

            <div class="controls">
              <input class="input-small" type="text" datepicker-popup="MM/dd/yyyy" ng-model="editEventData.end_time" ng-required="true" readonly>
              <input class="input-mini time" type=text value="[[ editEventData.end_time | date:'HH:mm' ]]" id="editEvent-endTime" readonly>
            </div>
          </div>

          <div class="control-group">
            <label class="control-label">location name</label>

            <div class="controls" id="usernameControl">
              <span class="input-large uneditable-input" id="editEvent-locationName">[[ editEventData.location_names[0] ]]</span>
            </div>
          </div>

          <input class="input-small" type=hidden id="editEvent-suggestedInterval">
          <input class="input-small" type=hidden id="editEvent-locationLat">
          <input class="input-small" type=hidden id="editEvent-locationLng">
        </form>
      </div>

      <div class="modal-footer">
        <button class="btn" ng-click="hideEditEvent()">Close</button>
        <button class="btn btn-primary" id="editEvent-confirm-btn" ng-click="confirm()">[[ buttonText ]]</button>
      </div>
    </div>
  </script>

</div>


<div class="width-floating height-floating subContainer" id="centerContainer">
  <div class="height-fixed">
    <button class="btn" data-toggle="button" id="showRouteButton">Show Route</button>
  </div>
  <div class="height-floating mapContainer" id="mapContainer" ng-controller="MapCtrl"></div>
  <div class="eventWindow" id="eventWindow"></div>
</div>
<div class="width-fixed pull-right height-floating subContainer" id="rightContainer">
  <div class="input-append height-fixed">
    <input id="searchTextField" class="span2" placeholder="Search for a location...">
    <button class="btn btn-primary" id="map-search-btn"><a class="icon-search icon-white"></a></button>
  </div>
  <div id="results" class="height-floating gray"></div>
</div>



{% endblock %} <!-- block body -->
{% block after %}

{% endblock %} <!-- block after -->
